{% extends 'backends/base_template.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div style="background-color:#f5f7fa; padding:30px; border-radius:12px;">

    <h1 style="text-align:center; font-size:2rem; margin-bottom:25px;">{{ title }}</h1>

    <!-- 반기 전환 버튼 -->
    <div class="half-tab-container">
        {% for half, data in images_by_half.items %}
        <button onclick="showHalf('{{ half }}')" class="half-tab">
            {{ data.label }}
        </button>
        {% endfor %}
    </div>

    <style>
    .half-tab-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    }

    .half-tab {
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    background-color: #f1f3f5;
    color: #333;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    }

    .half-tab:hover {
    background-color: #007bff;
    color: white;
    }

    .half-tab.active {
    background-color: #0056b3;
    color: white;
    }
    </style>

    <!-- 반기별 컨테이너 -->
    {% for half, data in images_by_half.items %}
    <div id="half-{{ half }}" class="half-container" style="display:none;">
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(400px, 1fr)); gap:24px;">
            {% for item in data.charts %}
            <div style="background-color:white; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
                        padding:20px; transition:transform 0.3s; overflow:hidden;">
                <h3 style="text-align:center; font-size:1.2rem; color:#333;">{{ item.title }}</h3>
                <blockquote style="background-color:#f9fafb; border-left:5px solid #a0aec0;
                                    padding:12px 18px; margin-top:15px; border-radius:6px;
                                    font-size:0.95rem; color:#4a5568; line-height:1.5;">
                    {{ item.desc }}
                </blockquote>
                <div style="margin-top:10px; width:100%; height:100%; min-height:350px;">
                    {{ item.img|safe }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

</div>

<script>
function showHalf(half) {
    document.querySelectorAll(".half-container").forEach(div => div.style.display = "none");
    document.getElementById("half-" + half).style.display = "block";

    // 탭 전환 시 plotly 차트 리사이즈 강제 실행
    setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
    }, 100);
}

{% if first_half %}
showHalf("{{ first_half }}");
{% endif %}

window.addEventListener("load", function() {
    window.dispatchEvent(new Event('resize'));
});
</script>

{% endblock %}