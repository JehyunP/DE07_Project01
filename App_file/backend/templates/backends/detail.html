{% extends 'backends/base_template.html' %}
{% load humanize %}
{% block title %}프로그램 상세정보{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 1500px;">
    <div class="row g-4">
        <!-- 왼쪽: 포스터 -->
        <div class="col-md-5">
            <div class="card shadow h-100">
                <img src="{{ program.poster }}" class="card-img-top" alt="{{ program.title }}" style="object-fit: cover; height: 100%;">
            </div>
        </div>

        <!-- 오른쪽: 프로그램 정보 -->
        <div class="col-md-7">
            <div class="card shadow mb-3">
                <div class="card-body">
                    <h2 class="card-title">{{ program.title }}</h2>
                    <p class="card-text text-muted">{{ program.description }}</p>
                </div>
            </div>

            <!-- 상세 정보 -->
            <div class="card shadow mb-3">
                <div class="card-body">
                    <h5 class="card-title">기본 정보</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>개봉년도:</strong> {{ program.release }}</li>
                        <li class="list-group-item"><strong>국가:</strong> {{ program.country }}</li>
                        <li class="list-group-item"><strong>제작사:</strong> {{ program.production }}</li>
                        <li class="list-group-item"><strong>장르:</strong> {{ program.genre.name }}</li>
                        {% if program.sub_genre %}
                        <li class="list-group-item"><strong>서브 장르:</strong> {{ program.sub_genre.name }}</li>
                        {% endif %}
                        <li class="list-group-item"><strong>타입:</strong> {{ program.program_type }}</li>
                        <li class="list-group-item"><strong>상영시간:</strong> {{ program.runtime_hour }} 시간</li>
                    </ul>
                </div>
            </div>

            <!-- 출연 / 감독 / 프로듀서 -->
            <div class="row">
                <!-- 감독 -->
                <div class="col-md-4">
                    <div class="card shadow mb-3">
                        <div class="card-body">
                            <h6 class="card-title">감독</h6>
                            <p class="card-text">
                                {% for d in directors|slice:":3" %}
                                    {{ d.person.name }}<br>
                                {% empty %}정보 없음{% endfor %}
                            </p>
                            {% if directors|length > 3 %}
                                <div class="collapse" id="directorsMore">
                                    <p class="card-text">
                                        {% for d in directors|slice:"3:" %}
                                            {{ d.person.name }}<br>
                                        {% endfor %}
                                    </p>
                                </div>
                                <a class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" href="#directorsMore" role="button">
                                    더보기
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- 출연 -->
                <div class="col-md-4">
                    <div class="card shadow mb-3">
                        <div class="card-body">
                            <h6 class="card-title">출연</h6>
                            <p class="card-text">
                                {% for a in actors|slice:":3" %}
                                    {{ a.person.name }}<br>
                                {% empty %}정보 없음{% endfor %}
                            </p>
                            {% if actors|length > 3 %}
                                <div class="collapse" id="actorsMore">
                                    <p class="card-text">
                                        {% for a in actors|slice:"3:" %}
                                            {{ a.person.name }}<br>
                                        {% endfor %}
                                    </p>
                                </div>
                                <a class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" href="#actorsMore" role="button">
                                    더보기
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- 프로듀서 -->
                <div class="col-md-4">
                    <div class="card shadow mb-3">
                        <div class="card-body">
                            <h6 class="card-title">프로듀서</h6>
                            <p class="card-text">
                                {% for p in producers|slice:":3" %}
                                    {{ p.person.name }}<br>
                                {% empty %}정보 없음{% endfor %}
                            </p>
                            {% if producers|length > 3 %}
                                <div class="collapse" id="producersMore">
                                    <p class="card-text">
                                        {% for p in producers|slice:"3:" %}
                                            {{ p.person.name }}<br>
                                        {% endfor %}
                                    </p>
                                </div>
                                <a class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" href="#producersMore" role="button">
                                    더보기
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- 스트리밍 -->
            <div class="card shadow mb-3">
                <div class="card-body">
                    <h5 class="card-title">스트리밍 서비스</h5>
                    <p class="card-text">
                        {% for s in streamings %}<span class="badge bg-primary me-1">{{ s.ott }}</span>{% empty %}정보 없음{% endfor %}
                    </p>
                </div>
            </div>

            <!-- 닫기 버튼 -->
            <div class="d-flex justify-content-center mt-4">
                <a href="#" onclick="window.close();" class="btn btn-outline-secondary btn-lg px-4 shadow">
                    닫기 ✖
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
