{% extends 'backends/base_template.html' %}
{% block title %}서브 장르 프로그램 목록{% endblock %}
{% block content %}

<h2>{{ subgenre.name }} 프로그램 목록 ({{ half_year }}, 시청뷰수 기준)</h2>

<div class="container">
  <div class="row g-3">
    {% for item in programs %}
      <div class="col-6 col-md-4 col-lg-2">
        <!-- 카드 클릭 가능 -->
        <div class="card h-100 program-card" 
             data-program-id="{{ item.program.id }}"
             style="cursor: pointer;">
          <!-- 순위 -->
          <div class="text-center mt-2">
            <span class="badge bg-danger">#{{ item.rank }}</span>
          </div>

          <!-- 포스터 -->
          <img src="{{ item.program.poster }}" 
               alt="{{ item.program.title }} 포스터" 
               class="card-img-top" style="border-radius: 8px;">

          <div class="card-body text-center p-2">
            <h6 class="card-title mb-1">{{ item.program.title }}</h6>
            <p class="text-muted mb-1" style="font-size: 0.85em;">({{ item.program.release }})</p>
            <p class="small text-dark mb-0">조회수: {{ item.views }}</p>
          </div>
        </div>
      </div>
    {% empty %}
      <p>등록된 프로그램이 없습니다.</p>
    {% endfor %}
  </div>
</div>

<!-- 뒤로가기 버튼 -->
<a href="{% url 'backends:genre_distribution' half_year %}" class="back-card">
  <div class="back-card-body">
      ← 뒤로가기
  </div>
</a>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const cards = document.querySelectorAll(".program-card");

  cards.forEach(card => {
    card.addEventListener("click", function () {
      const programId = this.dataset.programId;

      // 새창 크기 및 위치
      const width = 1500, height = 1000;
      const left = (screen.width - width) / 2;
      const top = (screen.height - height) / 2;

      // Django detail 뷰 URL 생성
      const urlTemplate = "{% url 'backends:detail' 0 %}";
      const programUrl = urlTemplate.replace("0", programId);

      // 새창 열기
      window.open(
        programUrl,
        "ProgramDetail",
        `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`
      );
    });
  });
});
</script>

{% endblock %}